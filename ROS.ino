//data.data[0] = 42
//data.data[1] = blockNumber
//data.data[2] = upFace (as an integer)
//
//[3] = Integer blockNumber of cube connected to face 1
//[4]  = Integer number of [3]’s face that this is connected to
//(For example, if side 1 of this cube is connected to cube 27’s 2nd face, then [3] = 27 and [4] = 2)
//
//[5] = Integer blockNumber of cube connected to face 2
//[6] = Integer number of [5]’s face that this is connected to
//
//[7]
//[8]   same for this cube’s 3rd face
//
//[9] & [10] for this cubes’s 4th face
//
//[11] & [12] for this cube’s 5th face
//
//[13] & [14] for this cube’s 6th face

void publish_neighbor_info()
{ 
  if(DEBUG){Serial.println("Publishing things... neighbors");}
//  for(int x = 2; x <= 7; x++){
//    Status[x] = read_ambient(x-1);
  int Neighbors[15];
  Neighbors[0]  = neighbor_message_number;
  Neighbors[1]  = cube_id;
  Neighbors[2]  = which_face_is_up(12000);
  Neighbors[3]  = face_neighbors[1][n_cube_id];
  Neighbors[4]  = face_neighbors[1][n_face_id];
  Neighbors[5]  = face_neighbors[2][n_cube_id];
  Neighbors[6]  = face_neighbors[2][n_face_id];
  Neighbors[7]  = face_neighbors[3][n_cube_id];
  Neighbors[8]  = face_neighbors[3][n_face_id];
  Neighbors[9]  = face_neighbors[4][n_cube_id];
  Neighbors[10] = face_neighbors[4][n_face_id];
  Neighbors[11] = face_neighbors[5][n_cube_id];
  Neighbors[12] = face_neighbors[5][n_face_id];
  Neighbors[13] = face_neighbors[6][n_cube_id];
  Neighbors[14] = face_neighbors[6][n_face_id];

  neighbor_msg.data = Neighbors;
  pub_neighbor.publish(&neighbor_msg);
}

void publishAwake()
{
  awake_msg.data = IDnumber;
  pub_awake.publish(&awake_msg);
}
///
void publishstatus()
{ 
  if(DEBUG){Serial.println("Publishing things");}
  fbrxen(1);
  delay(2);
  int Status[13];
  for(int x = 2; x <= 7; x++){
    Status[x] = read_ambient(x-1);
  }
  read_accel();
  Status[0] = IDnumber;
  Status[1] = millis();//int(nh.now()); 
  Status[8] = which_face_is_up(12000);
  Status[9] = forward_face;
  Status[10] = which_plane_am_i_in;
  Status[11] = readMagnet();
  Status[12] = ((vbat[1]+vbat[2]+vbat[3]+vbat[4])/4);

  status_msg.data = Status;
  pub_status.publish(&status_msg);
}

void init_nh() // Begins ROS bs
{ 
  if(DEBUG){Serial.println("Beginning init_nh");}
  
  if(which_alternate){nh.initNode("192.168.1.100");}
  else{nh.initNode("192.168.0.100");}
  
  if(DEBUG){Serial.println("Made it past initNode");}
  status_msg.data_length=13;
  neighbor_msg.data_length=15;
  nh.subscribe(sub_cmd);
  nh.subscribe(sub_cmd);
  nh.subscribe(sub_general);
  nh.advertise(pub_status);
  nh.advertise(pub_neighbor);
  nh.advertise(pub_awake);
  nh.advertise(pub_ser);
  if(DEBUG){Serial.println("ending init_nh");}
}
//////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////// HELPER FUNCTIONS//////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////// HELPER FUNCTIONS//////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////// HELPER FUNCTIONS//////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////////
void loop_safe_delay(int delay_cycles)
{
Serial.println("stillalive");
for(int i = 0;i < delay_cycles; i++){delay(42);Serial.println("Still_alive");}
}

void ros_safe_delay(int delay_time)
{
Serial.println("stillalive");
for(int i = 0;i < delay_time/200; i++){delay(200);if(is_ros_on){nh.spinOnce();publishAwake();}}
}

void irled_ROS()
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////

  //i r l e d _ 1 _ 1  0  1 0
  // 0 1 2 3 4 5 6 7 8 9 10 11 12
{
  { 
    if(cmd.substring(6) == "off"){delay(15);IRLED_OFF();delay(15);IRLED_OFF();cmd = "chill";}
    else
    {
    String temp_face = cmd.substring(6,7);
    //face_rgb(temp_face.toInt(), 1, 1, 1, 0);
    String LED1 = cmd.substring(8,9); String LED2 = cmd.substring(9,10); String LED3 = cmd.substring(10,11); String LED4 = cmd.substring(11,12);
    IRLED(temp_face.toInt(),LED1.toInt(),LED2.toInt(),LED3.toInt(),LED4.toInt()); 
    }
  }
}
